<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Points Allocation Template Generator</title>
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">

<div class="max-w-4xl mx-auto">
  <div class="bg-white rounded-xl shadow-lg p-8">
    <div class="flex items-center gap-3 mb-8">
      <i data-lucide="file-spreadsheet" class="w-8 h-8 text-indigo-600"></i>
      <h1 class="text-3xl font-bold text-gray-800">Points Allocation Template Generator</h1>
    </div>

    <!-- Form Fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Country of Field *</label>
        <input id="country" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Cortex ID *</label>
        <input id="cortex" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">RAES Job Number *</label>
        <input id="job" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Points *</label>
        <input id="points" type="number" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
      </div>
    </div>

    <!-- Reason -->
    <div class="mt-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Reason for Allocating Additional Points *</label>
      <textarea id="reason" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
    </div>

    <!-- IDs -->
    <div class="mt-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Panelist IDs *</label>
      <textarea id="ids" rows="8" placeholder="Enter IDs (newline/comma/space separated)" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono"></textarea>
      <div id="id-count" class="mt-2 text-sm text-gray-600"></div>
    </div>

    <!-- Buttons -->
    <div class="mt-8 flex gap-4 justify-center">
      <button id="add-batch-btn" class="flex items-center gap-3 px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
        <i data-lucide="plus" class="w-5 h-5"></i>
        Add Batch
      </button>
      <button id="generate-btn" class="flex items-center gap-3 px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium">
        <i data-lucide="download" class="w-5 h-5"></i>
        Generate Excel File
      </button>
    </div>

    <!-- Batch Preview Table -->
    <div class="mt-8">
      <h2 class="text-lg font-semibold mb-3">Batches Added</h2>
      <table class="w-full border-collapse border border-gray-300 text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="border border-gray-300 px-2 py-1">#</th>
            <th class="border border-gray-300 px-2 py-1">Country</th>
            <th class="border border-gray-300 px-2 py-1">Cortex ID</th>
            <th class="border border-gray-300 px-2 py-1">RAES Job</th>
            <th class="border border-gray-300 px-2 py-1">Points</th>
            <th class="border border-gray-300 px-2 py-1"># IDs</th>
            <th class="border border-gray-300 px-2 py-1">Reason</th>
          </tr>
        </thead>
        <tbody id="batch-table-body">
          <tr><td colspan="7" class="text-center text-gray-500 py-3">No batches added yet</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
lucide.createIcons();

function splitIds(input) {
  return input
    .split(/[\n,\t; ]+/)
    .map(id => id.trim())
    .filter(id => id.length > 0);
}

let batches = [];

document.getElementById("ids").addEventListener("input", function () {
  const ids = splitIds(this.value);
  document.getElementById("id-count").textContent = `Detected IDs: ${ids.length}`;
});

document.getElementById("add-batch-btn").addEventListener("click", function () {
  const country = document.getElementById("country").value.trim();
  const cortex = document.getElementById("cortex").value.trim();
  const job = document.getElementById("job").value.trim();
  const points = document.getElementById("points").value.trim();
  const reason = document.getElementById("reason").value.trim();
  const ids = splitIds(document.getElementById("ids").value);

  if (!country || !cortex || !job || !points || !reason || ids.length === 0) {
    return alert("Please fill in all fields and add at least one ID.");
  }

  batches.push({ country, cortex, job, points, reason, ids });

  updateBatchTable();

  // Clear form
  document.getElementById("country").value = "";
  document.getElementById("cortex").value = "";
  document.getElementById("job").value = "";
  document.getElementById("points").value = "";
  document.getElementById("reason").value = "";
  document.getElementById("ids").value = "";
  document.getElementById("id-count").textContent = "";
});

function updateBatchTable() {
  const tbody = document.getElementById("batch-table-body");
  tbody.innerHTML = "";
  batches.forEach((batch, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="border border-gray-300 px-2 py-1">${index + 1}</td>
      <td class="border border-gray-300 px-2 py-1">${batch.country}</td>
      <td class="border border-gray-300 px-2 py-1">${batch.cortex}</td>
      <td class="border border-gray-300 px-2 py-1">${batch.job}</td>
      <td class="border border-gray-300 px-2 py-1">${batch.points}</td>
      <td class="border border-gray-300 px-2 py-1">${batch.ids.length}</td>
      <td class="border border-gray-300 px-2 py-1">${batch.reason.length > 30 ? batch.reason.substring(0, 27) + "..." : batch.reason}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById("generate-btn").addEventListener("click", function () {
  if (batches.length === 0) return alert("Please add at least one batch before generating the file.");

  let allData = [];
  batches.forEach(batch => {
    batch.ids.forEach(id => {
      allData.push({
        "Country of field": batch.country,
        "panelist_id": id,
        "points": batch.points,
        "description(cortexid of the batch from S1)": batch.cortex,
        "JB and Name of the project": batch.job,
        "Reason for allocating additional points": batch.reason
      });
    });
  });

  const ws = XLSX.utils.json_to_sheet(allData);
  ws["!cols"] = [
    { wch: 18 },
    { wch: 15 },
    { wch: 10 },
    { wch: 35 },
    { wch: 25 },
    { wch: 40 }
  ];

  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Panelist Data");

  XLSX.writeFile(wb, "Template_manual_points_allocation.xlsx");
});
</script>
</body>
</html>
